<!doctype html>
<html class="theme-next use-motion theme-next-mist">
<head>
  
    


<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>


<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />








  <link rel="stylesheet" type="text/css" href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5"/>




<link rel="stylesheet" type="text/css" href="/css/main.css?v=0.4.5.1"/>




  <meta name="keywords" content="Hexo,next" />



  <link rel="alternate" href="/atom.xml" title="Dev Note" type="application/atom+xml" />



  <link rel="shorticon icon" type="image/x-icon" href="/favicon.ico?v=0.4.5.1" />


<meta property="og:type" content="website">
<meta property="og:title" content="Dev Note">
<meta property="og:url" content="http://note.49px.com/page/4/index.html">
<meta property="og:site_name" content="Dev Note">
<meta property="article:author" content="Yang Le">
<meta name="twitter:card" content="summary">


<script type="text/javascript" id="hexo.configuration">
  var CONFIG = {
    scheme: 'Mist',
    sidebar: 'post'
  };
</script>

  <title> Dev Note </title>
<meta name="generator" content="Hexo 4.2.0"></head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  <!--[if lte IE 8]>
  <div style=' clear: both; height: 59px; padding:0 0 0 15px; position: relative;margin:0 auto;'>
    <a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home?ocid=ie6_countdown_bannercode" target="_blank" rel="noopener">
      <img src="http://7u2nvr.com1.z0.glb.clouddn.com/picouterie.jpg" border="0" height="42" width="820"
           alt="You are using an outdated browser. For a faster, safer browsing experience, upgrade for free today or use other browser ,like chrome firefox safari."
           style='margin-left:auto;margin-right:auto;display: block;'/>
    </a>
  </div>
<![endif]-->
  



  <div class="container one-column 
   page-home 
">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><h1 class="site-meta">
  <span class="logo-line-before"><i></i></span>
  <a href="/" class="brand" rel="start">
      <span class="logo">
        <i class="icon-next-logo"></i>
      </span>
      <span class="site-title">Dev Note</span>
  </a>
  <span class="logo-line-after"><i></i></span>
</h1>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu ">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            <i class="menu-item-icon icon-next-home"></i> <br />
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            <i class="menu-item-icon icon-next-archives"></i> <br />
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            <i class="menu-item-icon icon-next-tags"></i> <br />
            标签
          </a>
        </li>
      

      
      
    </ul>
  

  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div id="content" class="content"> 
  <section id="posts" class="posts-expand">
    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/coredata/" itemprop="url">
                CoreData笔记
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2013-08-12T00:00:00+08:00" content="2013-08-12">
            2013-08-12
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/coredata/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="coredata/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><ul>
<li><a href="https://developer.apple.com/library/ios/documentation/cocoa/Conceptual/CoreData/Articles/cdBasics.html" target="_blank" rel="noopener">Core Data Programming Guide</a>
<ul>
<li>数据库的table对应object，table的column对应property</li>
<li>NSManagedObjectContext通过coordinator管理存储，NSPersistentStoreCoordinator将实际的NSPersistentStore（如sqlite文件）和NSManagedObjectModel（编译后的data model）关联。</li>
</ul></li>
<li>CoreData使用多个数据库：
<ol type="1">
<li>在Xcode的DataModel中添加config，让entiey分属不同的config</li>
<li>ManagedObjectContext只关联一个PersistentStoreCoordinator，coordinator中可添加多个PersistentStore，让这些store分别对应不同的config：[coordinator addPersistentStoreWithType:<strong>configuration:</strong>URL:options:error:]</li>
<li>relationship只能用在同个PersistentStore中，跨store要使用FetchedRequest</li>
</ol>
参考：<a href="http://stackoverflow.com/questions/5231775/can-multiple-two-persistent-stores-be-used-with-one-object-model-while-mainta" target="_blank" rel="noopener">stackoverflow</a></li>
</ul>
<h3 id="加密coredata">加密CoreData</h3>
<ul>
<li><p>使用<a href="https://github.com/sqlcipher/sqlcipher" target="_blank" rel="noopener">sqlcipher</a>加密sqlite，可使用其<a href="https://github.com/sqlcipher/sqlcipher/tree/Xcode5" target="_blank" rel="noopener">Xcode5分支</a>：</p>
<ol type="1">
<li><p>编译：</p>
<pre><code> ./configure --with-crypto-lib=commoncrypto --enable-tempstore=yes CFLAGS=&quot;-DSQLITE_HAS_CODEC -DSQLITE_TEMP_STORE=2 -DSQLCIPHER_CRYPTO_CC&quot; LDFLAGS=&quot;-framework Security&quot; &amp;&amp; make sqlite3.c</code></pre>
<p>要禁掉sqlcipher项目的warnings，在Build Phases的<code>Compile Sources</code>中给sqlite3.c加上Compiler Flags：<code>-w</code></p></li>
<li><p>把<code>sqlcipher.xcodeproj</code>拉进Xcode作为子项目，在父项目Build Phases的<code>Target Depedencies</code>和<code>Link Binary With Libraries</code>中添加<code>sqlcipher</code></p></li>
<li><p>在父项目Build Settings的<code>Other C Flags</code>中添加：<code>-DSQLITE_HAS_CODEC</code></p></li>
</ol></li>
<li><p>使用<a href="https://github.com/project-imas/encrypted-core-data" target="_blank" rel="noopener">encrypted-core-data</a>加密CoreData，encrypted-core-data依赖sqlcipher</p></li>
<li><p>使用<a href="https://github.com/magicalpanda/MagicalRecord" target="_blank" rel="noopener">MagicalRecord</a>方便CoreData，见<a href="http://ablfx.com/blog/article/2" target="_blank" rel="noopener">使用入门</a></p>
<ul>
<li><p>使用前需要在<code>.pch</code>文件中添加：</p>
<pre><code>  #define MR_SHORTHAND
  #import &quot;CoreData+MagicalRecord.h&quot;</code></pre></li>
</ul></li>
</ul>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/js/" itemprop="url">
                Javascript笔记
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2013-04-30T00:00:00+08:00" content="2013-04-30">
            2013-04-30
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/js/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="js/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><ul>
<li><p>所有变量都是传引用，没有传值的</p></li>
<li><p>数字的内部表示都为double，所以1和1.0是相同的值</p></li>
<li><p>被当做false的值：null, undefined, ’’, 0, NaN</p></li>
<li><p>null，undefined不是对象；布尔，数字，字符串类似对象；其他都是对象，即可变的键值对集合</p></li>
<li><p>typeof检测的类型：‘boolean’, ‘number’, ‘string’, ‘undefined’, ’function‘, ‘object’</p></li>
<li><p>key:value对中的key是合法标识符时（仅含数字字母下划线）可以不加引号</p></li>
<li><p>引用对象属性时可以用<code>.</code>或<code>[]</code>，若属性名不是合法标识符则只能用<code>[]</code></p></li>
<li><p><code>hasOwnProperty()</code>查对象属性时不查prototype链，<code>delete</code>可删除对象属性</p></li>
<li><p>只有函数会创建作用域，花括号代码块不创建作用域</p></li>
<li><p><code>||</code>可提供默认值：<code>var middle = stooge["middle-name"] || "(none)"</code></p></li>
<li><p>除了声明时定义的形式参数，函数还接受两个附加的参数：<code>this</code>和<code>arguments</code>。<code>this</code>值取于四种模式之一：</p>
<ol type="1">
<li>当函数作为对象的属性时，this指向该对象</li>
<li>当函数不是对象的属性时，this指向全局对象。这设计错误导致内部函数的this指向了全局对象，而不是外部函数的this。解决方法是在外部函数中定义<code>var that = this;</code>，然后在内部函数中通过that来访问。</li>
<li>new Func()创建新对象时，this指向该对象</li>
<li>func.apply(that, arguments)调用函数时，this指向传进的that</li>
</ol>
<p>arguments可访问函数被调用时欲传进的实参列表，包括那些没有形参对应的多余参数。arguments类似数组，有length属性可下标访问，但设计错误使它没成为数组。吧arguments变成数组，使用<code>var args = Array.prototype.slice.apply(arguments)</code></p></li>
<li><p>函数总会返回一个值，没有指定返回值时返回undefined。如果以new Func()形式调用且返回值不是对象，则返回this（该新对象）。</p></li>
<li><p>模块：一个定义了私有变量和函数的函数，利用闭包创建可访问私有变量和函数的接口函数，最后返回这个接口函数，或者直接把接口内容存进某个可访问的函数中。</p></li>
<li><p>基于prototype继承是基于<em>对象</em>的继承，而不是基于类的继承</p></li>
<li><p>继承最好使用函数化模式：</p>
<pre><code>  var constructor = function(kv) {
      私有实例变量（可通过闭包访问）
      var that = 要继承的一个新对象
      给that添加属性或方法
      return that
  }</code></pre></li>
<li><p>数组只是类似数组的对象，它把数组下标转成字符串，用其作为属性。可存放任意类型元素，内部表示不是线性分配的内存。</p></li>
<li><p>数组的length等于其最大整数属性名加1，不一定等于数组的元素个数</p></li>
</ul>
<h4 id="references">References</h4>
<ol type="1">
<li><a href="http://bonsaiden.github.io/JavaScript-Garden/" target="_blank" rel="noopener">Javascript秘密花园</a></li>
<li>《Javascript语言精粹》</li>
</ol>
<hr />
<h3 id="promise">Promise</h3>
<ul>
<li>caller调then(callback)，callee调resolve()，两者都被调用后callback才会执行</li>
<li>多个then()链式调用时，上一个then()的返回值是下一个then()的输入参数</li>
<li><code>then(callback, errback)</code>的errback可提供reject()后的错误处理</li>
</ul>
<h4 id="references-1">References</h4>
<ol type="1">
<li><a href="http://mattgreer.org/articles/promises-in-wicked-detail/" target="_blank" rel="noopener">JavaScript Promises … In Wicked Detail</a></li>
</ol>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/uikit/" itemprop="url">
                UIKit笔记
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2013-01-04T00:00:00+08:00" content="2013-01-04">
            2013-01-04
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/uikit/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="uikit/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><ul>
<li><p>UIView与display相关的功能都在CALayer中，UIView仅给CALayer添上touch处理功能。 例如，UIView的位置相关信息保存在view.layer的四个属性中，<code>view.frame</code>根据它们导出：</p>
<ul>
<li>view.layer.position == view.center</li>
<li>view.layer.bounds == view.bounds</li>
<li>view.layer.anchorPoint</li>
<li>view.layer.transform</li>
</ul></li>
<li><p><code>view.layer.anchorPoint</code>默认为(0.5,0.5)，要将其设为view中另一点point:</p>
<p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">CGSize viewSize = view.frame.size;</span><br><span class="line">view.layer.anchorPoint = <span class="constructor">CGPointMake(<span class="params">point</span>.<span class="params">x</span><span class="operator">/</span><span class="params">viewSize</span>.<span class="params">width</span>, <span class="params">point</span>.<span class="params">y</span><span class="operator">/</span><span class="params">viewSize</span>.<span class="params">height</span>)</span>;</span><br><span class="line">view.layer.position = point;</span><br></pre></td></tr></table></figure></p></li>
<li><p>view.bounds指定view自己的坐标系统内正被观察到的矩形区域。比如，scrollView在scrolling时其实只是改变scrollView.bounds.origin (即scrollView.contentOffset)，而scrollView.contentSize只是和scrollView.bound.size一起限制scrollView.bounds.origin的变动范围。参见：<a href="http://oleb.net/blog/2014/04/understanding-uiscrollview/" target="_blank" rel="noopener">Understanding UIScrollView</a>。</p>
<p>view.frame.origin是view在其父view的坐标系统内的位置（由view.center配合view.layer.anchorPoint、view.bounds.size导出），而view.frame.size就是view.bounds.size。</p></li>
<li><p><code>UIWindow</code>含多个subview时，只有其<code>root</code> view才能自动处理autorotation。</p></li>
<li><p><code>[viewController presentViewController:animated:completion:]</code>时会把<code>presentingViewController.view</code>加到<code>viewController.view.superview</code>中，这superview是个隐藏节点<code>UITransitionView</code>。</p></li>
<li><p>ContainerViewController（iOS5起引入）继承UIViewController，添加childViewController时:</p>
<pre><code>  1. [self addChildViewController:childViewController]; 
  // 1. will send [childViewController willMoveToParentViewController:self];  
  2. [self.view addSubview:childViewController.view];
  3. [childViewController didMoveToParentViewController:self];</code></pre>
<p>移除childViewController时：</p>
<pre><code>  1. [childViewController willMoveToParentViewController:nil];
  2. [childViewController.view removeFromSuperview];
  3. [childViewController removeFromParentViewController];
  // 3. will send [childViewController didMoveToParentViewController:nil];</code></pre>
<p>参考：<a href="http://mobile.tutsplus.com/tutorials/iphone/implementing-container-containment-sliding-menu-controller/" target="_blank" rel="noopener">Implementing Container Containment – Sliding Menu Controller</a></p></li>
<li><p>要是创建项目时没有勾选<code>Use Storyboard</code>，从程序中加载storyboard要在<code>application:didFinishLaunchingWithOptions:</code>中：</p>
<pre><code>  // self.window = [[UIWindow alloc] initWithFrame:[[UIScreen mainScreen] bounds]];
  UIStoryboard *storyboard = [UIStoryboard storyboardWithName:@&quot;MainStoryboard&quot; bundle:nil];
  self.window.rootViewController = [storyboard instantiateInitialViewController];
  // [self.window makeKeyAndVisible];</code></pre>
<p>注：若打开第1行注释重设self.window，iOS8中需要在[YourApp]-Info.plist中去掉UIMainStoryboardFile值。</p></li>
<li><p><code>scrollViewWillEndDragging:withVelocity:targetContentOffset:</code>的<code>targetContentOffset</code>参数可以决定scrollView滑动停止在哪儿</p></li>
</ul>
<h4 id="runloopmode">RunloopMode</h4>
<p>Runloop只会处理其mode中输入源：</p>
<ul>
<li>default mode包含大部分输入源、定时器等</li>
<li>tracking mode处理UI事件（如scrollView滚动/减速等）</li>
<li>common modes = default mode | event mode</li>
</ul>
<p>定时器运行在default mode，scrollView滚动等UI事件肯能block定时器准时执行，可把定时器设成common modes：</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSTimer</span> *timer = [<span class="built_in">NSTimer</span> timerWithTimeInterval:<span class="number">1.0</span> </span><br><span class="line">                                         target:<span class="keyword">self</span></span><br><span class="line">                                       selector:<span class="keyword">@selector</span>(handleTimer:) </span><br><span class="line">                                       userInfo:<span class="literal">nil</span> </span><br><span class="line">                                       repeats:<span class="literal">NO</span>]</span><br><span class="line">[[<span class="built_in">NSRunLoop</span> mainRunLoop] addTimer:timer forMode:<span class="built_in">NSRunLoopCommonModes</span>];</span><br></pre></td></tr></table></figure>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[<span class="name">self</span> performsSelector:@selector(<span class="name">performDelayedWork</span>)</span><br><span class="line">            withObject:nil</span><br><span class="line">            afterDelay:1.0</span><br><span class="line">               inModes:@[<span class="name">NSRunLoopCommonModes</span>]]<span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>参考：</p>
<ul>
<li><a href="http://wufawei.com/2013/05/use-NSRunLoop/" target="_blank" rel="noopener">使用iOS的NSRunLoop</a></li>
<li>Enhancing User Experience with Scroll Views, <a href="https://developer.apple.com/videos/wwdc/2012/" target="_blank" rel="noopener">WWDC2012</a>#223</li>
</ul>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/bit/" itemprop="url">
                位操作
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2012-12-20T00:00:00+08:00" content="2012-12-20">
            2012-12-20
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/bit/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="bit/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><ul>
<li><p>计算二进制中1的个数</p>
<p>实质是求该二进制数与0的hamming距离，详见<a href="http://en.wikipedia.org/wiki/Hamming_weight" target="_blank" rel="noopener">wiki</a>。其分治解法 <strong>按位分片</strong> 统计1的个数：</p>
<pre><code>  count 1s in each  2-bit piece
  count 1s in each  4-bit piece
  count 1s in each  8-bit piece
  count 1s in each 16-bit piece
  count 1s in each 32-bit piece</code></pre>
<p>The best solutions known are based on adding counts in a tree pattern.</p>
<pre><code>  /*
   * For example, to count the number of 1 bits in the 8-bit binary number A=01101100
   * | Expression            | Binary   | Decimal | Comment                          |
   * | A                     | 01101100 |         | the original number              |
   * | B = A &amp; 01010101      | 01000100 | 1,0,1,0 | every other bit from A           |
   * | C = (A&gt;&gt;1) &amp; 01010101 | 00010100 | 0,1,1,0 | remaining bits from A            |
   * | D = B + C             | 01011000 | 1,1,2,0 | # of 1s in each 2-bit piece of A | 
   * | E = D &amp; 00110011      | 00010000 | 1,0     | every other count from D         |
   * | F = (D&gt;&gt;2) &amp; 00110011 | 00010010 | 1,2     | remaining counts from D          |
   * | G = E + F             | 00100010 | 2,2     | # of 1s in each 4-bit piece of A |
   * | H = G &amp; 00001111      | 00000010 | 2       | every other count from G         |
   * | I = (G&gt;&gt;4) &amp; 00001111 | 00000010 | 2       | remaining counts from G          |
   * | J = H + I             | 00000100 | 4       | the final answer                 |

  typedef unsigned int uint32;
  const uint32 m1  = 0x55555555; //binary: 0101...
  const uint32 m2  = 0x33333333; //binary: 00110011..
  const uint32 m4  = 0x0f0f0f0f; //binary: 0000111100001111..
  const uint32 m8  = 0x00ff00ff; //binary: 00000000111111110000000011111111
  const uint32 m16 = 0x0000ffff; //binary: 00000000000000001111111111111111

  int population_count(uint32 x) {
      x = (x &amp; m1 ) + ((x &gt;&gt;  1) &amp; m1 ); //put count of each  2 bits into those  2 bits 
      x = (x &amp; m2 ) + ((x &gt;&gt;  2) &amp; m2 ); //put count of each  4 bits into those  4 bits 
      x = (x &amp; m4 ) + ((x &gt;&gt;  4) &amp; m4 ); //put count of each  8 bits into those  8 bits 
      x = (x &amp; m8 ) + ((x &gt;&gt;  8) &amp; m8 ); //put count of each 16 bits into those 16 bits 
      x = (x &amp; m16) + ((x &gt;&gt; 16) &amp; m16); //put count of each 32 bits into those 32 bits 
      return x;
  }</code></pre>
<p>平时常见的解法：</p>
<p>This better when most bits in x are 0.</p>
<pre><code>  int population_count(uint32 x) {
      int count;
      for (count = 0; x; count++) {
         x &amp;= x-1; // zero out the least significant bit
      }
      return count;
  }</code></pre></li>
</ul>
<h3 id="least-significant-bit">least significant bit</h3>
<ul>
<li><p><code>-x</code> # == ~x+1, <strong>末位1前头的</strong>按位取反</p></li>
<li><p><code>x&amp;-x</code> # 末位1</p></li>
<li><p><code>x-1</code> # <strong>末位1起</strong>按位取反</p></li>
<li><p><code>x&amp;(x-1)</code> # 去掉末位1</p></li>
<li><p><code>(x&amp;(x-1)) == 0</code> # 是2的幂</p></li>
</ul>
<h3 id="most-significant-bit">most significant bit</h3>
<ul>
<li><p><strong>首位1起</strong>全置1</p>
<pre><code>  inline uint32 set_bits_from_msb(uint32 x) {
      x |= (x &gt;&gt; 1);
      x |= (x &gt;&gt; 2);
      x |= (x &gt;&gt; 4);
      x |= (x &gt;&gt; 8);
      x |= (x &gt;&gt; 16);
      return x;
  }</code></pre></li>
<li><p>首位1</p>
<pre><code>  uint32 msb(uint32 x) {
      x = set_bits_from_msb(x);
      return x &amp; ~(x &gt;&gt; 1);
  }</code></pre></li>
<li><p>下个最近2的幂</p>
<pre><code>  uint32 next_largest_power_of_2(uint32 x) {
      x = set_bits_from_msb(x);
      return x+1;
  }</code></pre></li>
<li><p>log2的floor</p>
<pre><code>  uint32 floor_of_log2(uint32 x) {
      x = set_bits_from_msb(x);
      return population_count(x) - 1;
  }</code></pre></li>
</ul>
<h2 id="reference">Reference</h2>
<ul>
<li><a href="http://en.wikipedia.org/wiki/Hamming_weight" target="_blank" rel="noopener">Hamming Weight</a></li>
<li><a href="http://aggregate.org/MAGIC/" target="_blank" rel="noopener">The Aggregate Magic Algorithms</a></li>
</ul>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/ruby/" itemprop="url">
                Ruby笔记
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2012-11-15T00:00:00+08:00" content="2012-11-15">
            2012-11-15
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/ruby/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="ruby/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><ul>
<li>sting interpolation: <code>"#{var_name}"</code>
<ul>
<li>双引号<code>""</code>转义其中的内容，单引号<code>‘’</code>不转义</li>
</ul></li>
<li>symbol是种不可变串，全局只创建一份，因此创建和比较等性能更高
<ul>
<li><code>:"hello"</code>等同于<code>:hello</code></li>
<li>symbol和string互转使用：<code>:hello.to_s</code>和<code>"hello".intern</code></li>
</ul></li>
<li>函数中的<code>yield(...)</code>会调用<em>函数调用时提供</em>的block，相当于把函数的一部分功能委派给这个未来的block，相当于函数多了一个叫yield的block参数
<ul>
<li>如果这个block参数是可选的，函数中要用<code>yield(…) if block_given?</code></li>
</ul></li>
<li>将01串表示的二进制转成字节数组： <code>['1100110011'].pack('B*').unpack('C*')</code><br />
参见：<a href="http://www.codeweblog.com/ruby-string-pack-unpack-detailed-usage/" target="_blank" rel="noopener">string的pack和unpack</a></li>
</ul>
<h2 id="nokogiri">nokogiri</h2>
<ul>
<li>取节点属性<code>node['attr-name']</code>，取某子节点内容<code>node.at_xpath('elem-name').text</code>
<ul>
<li>方法<code>.at_xpath()</code>返回第一个节点，<code>.xpath()</code>返回节点数组</li>
</ul></li>
</ul>
<h3 id="参考">参考</h3>
<ul>
<li><a href="http://www.58bits.com/blog/2012/06/13/getting-started-nokogiri-xml-ruby/" target="_blank" rel="noopener">getting started with nokogori and xml in ruby</a></li>
</ul>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/shell/" itemprop="url">
                Shell笔记
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2012-11-14T00:00:00+08:00" content="2012-11-14">
            2012-11-14
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/shell/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="shell/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>在命令执行失败后退出：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd || <span class="keyword">exit</span> <span class="number">1</span></span><br></pre></td></tr></table></figure>
<p>子shell（把命令由括号括起来）：</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmd | <span class="type">(cmd1</span>; cmd2; cmd3) | <span class="type">cmd4</span></span><br></pre></td></tr></table></figure>
<p>子shell中的<code>cmd1</code>可以改变工作目录，而不影响外部的<code>cmd4</code></p>
<p>捕获键盘中断：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">trap control_c SIGINT</span><br><span class="line"></span><br><span class="line">control_c() &#123;</span><br><span class="line">  echo `abort: ctrl-c`</span><br><span class="line">  <span class="keyword">exit</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>获得当前执行脚本的目录（<code>$0</code>就是当前执行脚本）：</p>
<figure class="highlight mel"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$(<span class="keyword">dirname</span> $0)</span><br></pre></td></tr></table></figure>
<p>if测试：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> [ ! -d <span class="variable">$A_DIR</span> ]; <span class="keyword">then</span></span><br><span class="line">  mkdir -p <span class="variable">$A_DIR</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="built_in">echo</span> <span class="string">'exists dir: '</span><span class="variable">$A_DIR</span></span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>
<p>for循环：</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> *; <span class="keyword">do</span> </span><br><span class="line">  <span class="built_in">echo</span> <span class="variable">$f</span>; </span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>
<h3 id="xargs">xargs</h3>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">ls</span> *<span class="string">.old</span> | xargs -n1 -I&#123;&#125; <span class="keyword">echo</span> mv &#123;&#125; &#123;&#125;<span class="string">.new</span></span><br></pre></td></tr></table></figure>
<ul>
<li><code>-n N</code>，将输入参数规整成一行N个的形式（原先的输入参数由<code>' '</code>或<code>\n</code>分隔，每行个数可能不一样）</li>
<li><code>-I {}</code>：由<code>-I</code>指定的字符串<code>{}</code>在每一次执行中都会被替换相应的输入参数</li>
</ul>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">find</span> . -<span class="built_in">type</span> f -<span class="built_in">name</span> <span class="string">"*.txt"</span> -print0 | xargs -<span class="number">0</span> rm -f</span><br></pre></td></tr></table></figure>
<ul>
<li><code>find -print0</code>指定输出的文件名以<code>\0</code>结尾</li>
<li><code>xargs -0</code>指定<code>\0</code>作为参数分隔符，而不是默认的<code>' '</code>或<code>\n</code></li>
</ul>
<p>只要把<code>find</code>的输出作为<code>xargs</code>的输入，就必须加<code>-print0</code>和<code>-0</code>参数，确保以<code>\0</code>来分隔输出。否则，文件名中包含的空格<code>' '</code>会被<code>xargs</code>会误以为是分隔符。</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">cat</span> <span class="keyword">args</span>.txt | ( <span class="keyword">while</span> <span class="keyword">read</span> arg; <span class="keyword">do</span> <span class="keyword">cat</span> <span class="variable">$arg</span>; done)</span><br><span class="line"># 等同于 <span class="keyword">cat</span> <span class="keyword">args</span>.txt | xargs -I&#123;&#125; <span class="keyword">cat</span> &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>为对同一个参数执行多条命令，使用while循环，将<code>cat $arg</code>换成任意数量的命令</p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/c/" itemprop="url">
                C笔记
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2012-10-08T00:00:00+08:00" content="2012-10-08">
            2012-10-08
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/c/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="c/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><ul>
<li><p>C99的inline用法和C++稍有不同，portable用法见<a href="http://www.greenend.org.uk/rjk/tech/inline.html" target="_blank" rel="noopener">Inline Functions In C</a></p>
<p>the xxx.h file:</p>
<pre><code>  #ifndef INLINE
  # if __GNUC__ &amp;&amp; !__GNUC_STDC_INLINE__
  #  define INLINE extern inline
  # else
  #  define INLINE inline
  # endif
  #endif
  INLINE int max(int a, int b) {
      return a &gt; b ? a : b;
  }</code></pre>
<p>the xxx.c file:</p>
<pre><code>  #define INLINE
  #include &quot;xxx.h&quot;</code></pre></li>
<li><p><a href="http://stackoverflow.com/a/11517413/1263403" target="_blank" rel="noopener">参数个数不同的macro重载</a></p></li>
<li><p>由于内存对齐，定义struct时应将成员从大到小排列最省空间</p></li>
</ul>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/java/" itemprop="url">
                Java笔记
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2012-09-24T00:00:00+08:00" content="2012-09-24">
            2012-09-24
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/java/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="java/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><ul>
<li><p>用[jarjar][]修改jar中的包名或类名：</p>
<pre><code>java -jar jarjar.jar process &lt;rulesFile&gt; &lt;inJar&gt; &lt;outJar&gt;</code></pre>
<p><rulesFile>每条rule一行，包名或类名匹配多条rule时只取最上一条，rule格式：</p>
<pre><code>rule &lt;pattern&gt; &lt;resule&gt;</code></pre>
<p>替换包名用：<code>rule old.package.** new.package.@1</code><br />
替换类名用：<code>rule **OldClass @1NewClass</code></p></li>
</ul>
<p>[jarjar]: [http://code.google.com/p/jarjar/wiki/CommandLineDocs]</p>
<ul>
<li>用[jd-gui][]查看jar包中.class的代码</li>
</ul>
<p>[jd-gui]: [http://java.decompiler.free.fr/?q=jdgui]</p>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/cxx11/" itemprop="url">
                C++11笔记
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2012-09-05T00:00:00+08:00" content="2012-09-05">
            2012-09-05
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/cxx11/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="cxx11/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><ul>
<li><p>xCode中开启c++11支持：</p>
<pre><code>  Build Settings -&gt; C++ Language Dialect 选 C++11
                 -&gt; C++ StandardLibrary 选 libc++</code></pre></li>
<li><p>lambda：</p>
<p>语法: <code>[capture-list](args-list) -&gt;return-type {…}</code></p>
<p>可转类型：<code>function&lt;return-type (args-type-list)&gt;</code></p>
<ul>
<li><p>lambda的类型是实现了<code>operator()</code>的匿名类型，可转成<code>std::function&lt;&gt;</code>，但不是std::function&lt;&gt;，因此</p>
<pre><code>  template&lt;typename ...Args&gt;
  void call(Args&amp;&amp; ...args) { std::cout &lt;&lt; &quot;call 1&quot;; }
  template&lt;typename ...Args&gt;
  void call(std::function&lt;void ()&gt;, Args&amp;&amp; ...args) { std::cout &lt;&lt; &quot;call 2&quot;; }</code></pre>
<p>调用<code>call([](){});</code>输出<em>call 1</em>，而不是<em>call 2</em></p>
<p>要输出<em>call 2</em>，函数调用时要显式将lambda参数转成std::function类型：</p>
<pre><code>  call(std::function&lt;void ()&gt;([](){}))</code></pre></li>
</ul></li>
<li><p>range-based for:</p>
<p>遍历map:</p>
<pre><code>  for (auto&amp; kv : aMap) {
      cout &lt;&lt; kv.first &lt;&lt; &quot; has value &quot; &lt;&lt; kv.second &lt;&lt; endl;
  } </code></pre>
<p>非成员函数的<code>begin()</code>和<code>end()</code>：要定义在CustomClass所在的namespace中</p></li>
<li><p>取tuple中第i个元素：<code>std::get&lt;i&gt;(tuple)</code></p></li>
<li><p>string和number间互转：</p>
<pre><code>  string to_string(int val);
  string to_string(float val);
  …
  int stoi(const string&amp; str, size_t *idx=0, int base=10);
  float stof(const string&amp; str, size_t *idx=0);
  …</code></pre></li>
<li><p>unique_ptr使用自定义deleter，例如：</p>
<pre><code>  template&lt;typename T&gt;
  using cc_unique_ptr = std::unique_ptr&lt;T, std::function&lt;void(void *)&gt;&gt;;
  template&lt;typename T&gt;
  cc_unique_ptr&lt;T&gt; make_unique(T *ptr) {
      if (ptr) ptr-&gt;retain();
      auto deleter = [](void *p) {
          auto ptr = static_cast&lt;T *&gt;(p);
          if (ptr) ptr-&gt;release();
      };
      return cc_unique_ptr&lt;T&gt;(ptr, deleter);
  }</code></pre></li>
<li><p>为enum指定underlying type: <code>enum E : short { kValue1, kValue2, ... }</code>，然后可以使用forward declare: <code>enmu E : short;</code></p></li>
<li><p>强类型enum用关键字<code>enum class</code>声明，其枚举值不会暴露在surrounding scope</p>
<pre><code>  enum class Options {None, One, All};
  Options o = Options::All;</code></pre></li>
<li><p>可给函数方法添加后置标识符<code>override</code>（指明某函数重载父类函数）和<code>final</code>(指明某函数不能被子类重载)</p></li>
<li><p>支持正则表达式<code>&lt;regex&gt;</code></p></li>
</ul>
<h3 id="参考">参考</h3>
<ul>
<li><a href="http://herbsutter.com/elements-of-modern-c-style/" target="_blank" rel="noopener">Elements of Modern C++ Style</a></li>
<li><a href="http://www.stroustrup.com/C++11FAQ.html" target="_blank" rel="noopener">C++11 FAQ</a></li>
<li><a href="http://gcc.gnu.org/projects/cxx0x.html" target="_blank" rel="noopener">C++11 Support in GCC</a></li>
<li><a href="http://www.stroustrup.com/ETAPS-corrected-draft.pdf" target="_blank" rel="noopener">Foundation of C++</a></li>
<li><a href="http://www.codeproject.com/Articles/570638/Ten-Cplusplus11-Features-Every-Cplusplus-Developer" target="_blank" rel="noopener">Ten C++11 Features Every C++ Developer Should Use</a></li>
</ul>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <header class="post-header">

      
      
        <h1 class="post-title" itemprop="name headline">
          
          
            
              <a class="post-title-link" href="/ccb/" itemprop="url">
                CocosBuilder配合Cocos2D-X
              </a>
            
          
        </h1>
      

      <div class="post-meta">
        <span class="post-time">
          发表于
          <time itemprop="dateCreated" datetime="2012-07-20T00:00:00+08:00" content="2012-07-20">
            2012-07-20
          </time>
        </span>

        

        
          
            <span class="post-comments-count">
              &nbsp; | &nbsp;
              <a href="/ccb/#comments" itemprop="discussionUrl">
                <span class="post-comments-count ds-thread-count" data-thread-key="ccb/" itemprop="commentsCount"></span>
              </a>
            </span>
          
        
      </div>
    </header>

    <div class="post-body">

      
      

      
        
          <span itemprop="articleBody"><p>由于c++没有反射，CocosBuilder配合cocos2d-x比cocos2d繁琐。</p>
<ul>
<li>设置node的Custom Class，要为该类写loader，该loader继承自<code>cocos2d::extension::CCXXXLoader</code></li>
<li>memberVar和menuItem的target可以是<code>doc root</code>或<code>owner</code></li>
<li>设置memberVar，会在load过称中调用target的<code>onAssignCCBMemberVariable</code>，即target要实现<code>cocos2d::extension::CCBSelectorResolver</code></li>
<li>设置menuItem的callback，会在load过称中调用target的<code>onResolveCCBCCMenuItemSelector</code>，即target要实现<code>cocos2d::extension::CCBSelectorResolver</code></li>
</ul>
<h4 id="case-1ccb中的cclayer关联代码中的gamelayer">Case 1：ccb中的CCLayer关联代码中的GameLayer</h4>
<ol type="1">
<li><p>ccb中CCLayer设置<em>Custom class</em>为<em>GameLayer</em></p></li>
<li><p>代码中为GameLayer添加loader类<code>class GameLayerLoader : public cocos2d::extension::CCLayerLoader</code>，为该loader实现<code>createCCNode()</code>方法。 若在ccb中给该CCLayer设置了<em>custom property</em>，还得在loader类中实现相应的<code>onHandlePropTypeXXX()</code>方法。</p></li>
<li><p>在提供给CCBReader的CCNodeLoaderLibrary中注册loader对象</p>
<pre><code> auto loaderLibrary = cocos2d::extension::CCNodeLoaderLibrary::newDefaultCCNodeLoaderLibrary();
 loaderLibrary-&gt;registerCCNodeLoader(“GameLayer”, nodeLoader);            </code></pre></li>
<li><p>代码中可选实现<code>class GameLayer: public cocos2d::extension::CCNodeLoaderListener</code></p></li>
</ol>
<p>
</p>
<ul>
<li><p>该过称繁杂，可写<a href="http://gist.github.com/4362371" target="_blank" rel="noopener">util函数</a>，然后：</p>
<pre><code>  auto layer = ccb::layer&lt;GameLayer&gt;(/*init params*/);</code></pre>
<p>如GameLayer含<em>Custom Class</em>子类<code>CustomMenuItemImage</code>，可用：</p>
<pre><code>  auto loaderLibrary = ccb::defaultCCNodeLoaderLibrary&lt;GameLayer, CCLayerLoader&gt;();
  ccb::registerCCNodeLoader&lt;CustomMenuItemImage, CCMenuItemImageLoader&gt;(loaderLibrary);
  auto layer = ccb::layer&lt;GameLayer&gt;(loaderLibrary/*, other init params*/);</code></pre></li>
</ul>
<h4 id="case-2.-ccb中的ccmenu关联代码gamelayer的buttonmenu">Case 2. ccb中的CCMenu关联代码GameLayer的buttonMenu</h4>
<ol type="1">
<li><p>ccb中CMenu设置<em>Code connections</em>：选<em>Doc root var</em>填<em>memberVar</em><br />
</p></li>
<li><p>代码中<code>class GameLayer : public cocos2d::extension::CCBMemberVariableAssigner</code>，并实现：</p>
<pre><code> bool onAssignCCBMemberVariable(cocos2d::CCObject * pTarget, cocos2d::CCString * pMemberVariableName, cocos2d::CCNode * pNode) {
     CCB_MEMBERVARIABLEASSIGNER_GLUE(this, &quot;_buttonMenu&quot;, CCMenu *, _buttonMenu);
     return false;
 }</code></pre>
<p>
</p></li>
</ol>
<ul>
<li><p>可定义简化宏：</p>
<pre><code>  #define CCB_MEMBER_VAR(__TYPE__, __VAR__) CCB_MEMBERVARIABLEASSIGNER_GLUE(this, #__VAR__, __TYPE__, __VAR__) </code></pre>
<p>然后<code>onAssignCCBMemberVariable()</code>中可写</p>
<pre><code>  CCB_MEMBER_VAR(CCMenu *, _buttonMenu);</code></pre></li>
</ul>
<h4 id="case-3ccb中ccmenuitem调用代码gamelayer的buttoncallback">Case 3：ccb中CCMenuItem调用代码GameLayer的buttonCallback</h4>
<ol type="1">
<li><p>ccb中的CCMenuItem设置：<em>selector</em>为<em>buttonCallback</em>，<em>Target</em>为<em>Document root</em></p></li>
<li><p>代码中<code>class GameLayer : public cocos2d::extension::CCBSelectorResolver</code>，并实现：</p>
<pre><code> cocos2d::SEL_MenuHandler onResolveCCBCCMenuItemSelector(cocos2d::CCObject * pTarget, cocos2d::CCString * pSelectorName) {
     CCB_SELECTORRESOLVER_CCMENUITEM_GLUE(this, &quot;buttonCallback&quot;, GameLayer::backButtonCallback);
     return NULL;
 }
 cocos2d::extension::SEL_CCControlHandler onResolveCCBCCControlSelector(cocos2d::CCObject * pTarget, cocos2d::CCString * pSelectorName) {
     return NULL;
 };</code></pre>
<p>
</p></li>
</ol>
<ul>
<li><p>可定义简化宏：</p>
<pre><code>  #define CCB_CCMENUITEM_SELECTOR(__CLASS__, __FUNC__) CCB_SELECTORRESOLVER_CCMENUITEM_GLUE(this, #__FUNC__, __CLASS__::__FUNC__)
  #define CCB_CCCONTROL_SELECTOR(__CLASS__, __FUNC__) CCB_SELECTORRESOLVER_CCCONTROL_GLUE(this, #__FUNC__, __CLASS__::__FUNC__)  </code></pre>
<p>然后<code>onResolveCCBCCMenuItemSelector()</code>中可写</p>
<pre><code>  CCB_CCMENUITEM_SELECTOR(GameLayer, backButtonCallback);</code></pre></li>
</ul>
<h4 id="参考">参考</h4>
<ul>
<li><a href="http://code.zynga.com/2012/10/creating-a-game-with-cocosbuilder/" target="_blank" rel="noopener">Creating a Game with CocosBuilder</a></li>
<li><a href="http://www.plungeinteractive.com/blog/using-cocosbuilder-on-cocos2d-x-games/" target="_blank" rel="noopener">Using CocosBuilder on Cocos2D-X games</a></li>
</ul>
</span>
        
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/3/">&lt;</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/3/">3</a><span class="page-number current">4</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/5/">&gt;</a>
  </nav>

 </div>

        

        
      </div>

      
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      <section class="site-overview">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" src="/images/avatar.png" alt="Yang Le" itemprop="image"/>
          <p class="site-author-name" itemprop="name">Yang Le</p>
        </div>
        <p class="site-description motion-element" itemprop="description"></p>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">47</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          <div class="site-state-item site-state-categories">
            
              <span class="site-state-item-count">0</span>
              <span class="site-state-item-name">分类</span>
              
          </div>

          <div class="site-state-item site-state-tags">
            <a href="/tags">
              <span class="site-state-item-count">13</span>
              <span class="site-state-item-name">标签</span>
              </a>
          </div>

        </nav>

        
          <div class="feed-link motion-element">
            <a href="/atom.xml" rel="alternate">
              <i class="menu-item-icon icon-next-feed"></i>
              RSS
            </a>
          </div>
        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        <div class="links-of-author motion-element">
          
        </div>

      </section>

      

    </div>
  </aside>


    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner"> <div class="copyright" >
  
  &copy; &nbsp; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="icon-next-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Yang Le</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io" target="_blank" rel="noopener">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next" target="_blank" rel="noopener">
    NexT.Mist
  </a>
</div>


 </div>
    </footer>

    <div class="back-to-top"></div>
  </div>

  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  
  
    

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"smilingpoplar"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>
    
     

    
  
  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js"></script>
  <script type="text/javascript" src="/js/fancy-box.js?v=0.4.5.1"></script>


  <script type="text/javascript" src="/js/helpers.js?v=0.4.5.1"></script>
  

  <script type="text/javascript" src="/vendors/velocity/velocity.min.js"></script>
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js"></script>

  <script type="text/javascript" src="/js/motion_global.js?v=0.4.5.1" id="motion.global"></script>




  <script type="text/javascript" src="/js/nav-toggle.js?v=0.4.5.1"></script>
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  

  <script type="text/javascript">
    $(document).ready(function () {
      if (CONFIG.sidebar === 'always') {
        displaySidebar();
      }
      if (isMobile()) {
        FastClick.attach(document.body);
      }
    });
  </script>

  
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
      processEscapes: true,
      skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
    }
  });
</script>

<script type="text/x-mathjax-config">
  MathJax.Hub.Queue(function() {
    var all = MathJax.Hub.getAllJax(), i;
    for (i=0; i < all.length; i += 1) {
      all[i].SourceElement().parentNode.className += ' has-jax';
    }
  });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>


  
  

  
  <script type="text/javascript" src="/js/lazyload.js"></script>
  <script type="text/javascript">
    $(function () {
      $("#posts").find('img').lazyload({
        placeholder: "/images/loading.gif",
        effect: "fadeIn"
      });
    });
  </script>
</body>
</html>
